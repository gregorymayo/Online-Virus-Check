<!DOCTYPE html>
<html>
<body>
	<form method="POST" action="" >	
		<label>For An Admin<br><br></label>
		Name: <input type="text" name="name"><br><br>
		Content: <input type="file" name="content"><br><br>
		<button name="UploadButton">Upload</button><br><br>
	</form>
	<button onclick="window.location.href='Midterm2Run.php'">Sign Out of Your Account</button>
	<br></br>
</body>
</html>

<?php
	
	require_once 'login.php';

	global $conn;
	$conn = new mysqli($hn, $un, $pw, $db);
	if ($conn->connect_errno) 
		echo "<br>The Connection Is Error<br>";

	//Upload Button For Admin
	if(isset($_POST['UploadButton'])){
	    	$name = $_POST['name'];
	    	$fileUpload = $_POST['content'];
	    	$nameChecker = true;
	    	//Suppose has a name
			if($name == '') {
				$nameChecker = false;
			}
	    	//The file does not exist
	    	if(!file_exists($fileUpload)) {
	    		echo "<br>The file does not exist<br>";
	    	}
			//Get the extention of the file
			$extension = pathinfo($fileUpload,PATHINFO_EXTENSION);
			//Open the file
			$fileOutput = fopen($fileUpload, "r");
			//Reading only the first 20 bytes
			$content = fread($fileOutput , 20);
			//Sanitizing the inputs
			$name = sanitize($conn, $name);
			$content = sanitize($conn, $content);

			//Check if the file is in txt
			if($extension == 'txt' && $nameChecker){
				$sql = "INSERT INTO table1 (ID, Name, Content) VALUES (NULL, '$name', '$content')";
				mysqli_query($conn,$sql);
				//close the file
				fclose($fileOutput);
			}	else if (!$nameChecker){
				echo "<br>Fill in the name of the Malware<br>";
			} else {
				echo "<br>The file is not in .txt format<br>";
			}
	}
?>